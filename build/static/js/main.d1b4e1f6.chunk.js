(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{146:function(e,t,a){e.exports={selectors:"iOiwMT-1TxxMLRgACDatD",chartContainer:"_1b6gGgX2FWpShEK49xJe08",yearModal:"_2LbZuV3XVAR4R6WKIkC_jX"}},211:function(e,t,a){e.exports={play_button:"_1A0Na77mvvdzir8BTaZ7Pe",traj_set:"_2HdPtE-HXij_-jd6mw586p"}},323:function(e,t,a){e.exports={charts:"oEFAxP79VZEMLn9X4OCbh"}},324:function(e,t,a){e.exports={searchWrapper:"_5UDuQJuf1p8makYUDFNrA"}},330:function(e,t,a){e.exports={toolbox_button:"WU8AGThvmAIisORzI8l_3"}},335:function(e,t,a){e.exports=a(733)},340:function(e,t,a){},341:function(e,t,a){},731:function(e,t,a){},733:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(5),s=a.n(i),o=(a(340),a(58)),l=a(148),c=a(13),h=a(14),u=a(16),p=a(15),d=a(17),m=a(740),y=(a(341),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).state={visible:!1},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"handleClickbout",value:function(){this.setState({visible:!0})}},{key:"handleCancel",value:function(){this.setState({visible:!1})}},{key:"render",value:function(){return n.a.createElement("div",{className:"header"},n.a.createElement("span",{className:"title"},this.props.title),n.a.createElement("button",{className:"about",onClick:this.handleClickbout.bind(this)},this.props.about),n.a.createElement(m.a,{title:this.props.aboutTitle,visible:this.state.visible,okText:"\u786e\u8ba4",footer:null,onCancel:this.handleCancel.bind(this)},n.a.createElement("p",null,"\u7b80\u4ecb\uff1a\u8be5\u5e73\u53f0\u5c55\u793a\u4e86\u5510\u671d\u4e0d\u540c\u5e74\u4ee3\u7684\u7586\u754c\u8303\u56f4\u3001\u4eba\u7269\u8f68\u8ff9\u53ca\u5386\u53f2\u4e8b\u4ef6\uff0c\u5e76\u652f\u6301\u67e5\u8be2\u641c\u7d22\u7b49\u529f\u80fd\u3002"),n.a.createElement("p",null,"\u5236\u4f5c\u6210\u5458\uff1a\u4faf\u9a81\u8c0b \u52b3\u5927\u948a \u5434\u5b87\u4e1c \u8a79\u6587")))}}]),t}(r.Component));y.defaultProps={title:"\u4e2d\u56fd\u5386\u53f2\u5730\u7406\u6570\u636e\u5c55\u793a\u5e73\u53f0",about:"\u5173\u4e8e\u6211\u4eec",aboutTitle:"ESRI DEMO-\u5386\u53f2\u5730\u7406\u4fe1\u606f\u5c55\u793a\u5e73\u53f0"};var v=y,f=a(739),b=a(741),g=a(39),E=a(146),C=a.n(E),S=a(210),w=a(21),k=a.n(w),x=(a(447),a(270),a(274),a(276),a(323)),j=a.n(x),O=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).charts=n.a.createRef(),a.lineChartsInstance=null,a.option=null,a}return Object(d.a)(t,e),Object(h.a)(t,[{key:"renderChart",value:function(e){var t=this;this.lineChartsInstance=k.a.init(this.charts.current),this.lineChartsInstance.setOption(this.option={tooltip:{trigger:"axis"},xAxis:{data:e.map(function(e){return e[0]})},yAxis:{show:!0,splitLine:{show:!1},interval:5e8,name:"\u9762\u79ef"},dataZoom:[{startValue:"2014-06-01"},{type:"inside"}],visualMap:{top:10,right:10},series:{name:"\u7586\u57df\u9762\u79ef",type:"line",data:e.map(function(e){return e[1]/1.56}),areaStyle:{}}},!0),this.lineChartsInstance.on("click","series",function(e){var a=e.dataIndex,r=e.name;console.log(e),t.props.onClick(a,r)})}},{key:"componentDidMount",value:function(){this.props.data.length&&this.renderChart.call(this,this.props.data)}},{key:"componentDidUpdate",value:function(){this.props.data.length&&this.renderChart.call(this,this.props.data)}},{key:"render",value:function(){return n.a.createElement("div",{style:this.props.style,className:j.a.charts},n.a.createElement("div",{ref:this.charts}))}}]),t}(r.Component),T=(a(485),a(495),a(501),function(e){return{title:{text:"\u5206\u5e03\u72b6\u51b5",left:"center",textStyle:{color:"#111"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : ({d}%)"},visualMap:{show:!1,min:80,max:600,inRange:{colorLightness:[0,1]}},series:[{name:"\u6bd4\u4f8b",type:"pie",radius:"55%",center:["50%","50%"],data:e,roseType:"radius",label:{normal:{textStyle:{color:"rgba(255, 255, 255, 0.3)"}}},labelLine:{normal:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"},smooth:.2,length:10,length2:20}},itemStyle:{normal:{color:"#c23531",shadowBlur:200,shadowColor:"rgba(0, 0, 0, 0.5)"}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(e){return 200*Math.random()}}]}}),L=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).charts=n.a.createRef(),a.lineChartsInstance=null,a.option=T(e.data),a}return Object(d.a)(t,e),Object(h.a)(t,[{key:"renderChart",value:function(e){var t=this;e=e.selectedBoundary.map(function(e){return{name:e.attributes.Name,value:parseInt(e.attributes.Area)}}),console.log(e),this.lineChartsInstance=k.a.init(this.charts.current),this.lineChartsInstance.setOption(T(e),!0),this.lineChartsInstance.on("click","series",function(e){var a=e.dataIndex,r=e.name;console.log(e),t.props.onClick(a,r)})}},{key:"componentDidMount",value:function(){this.props.data.length&&this.renderChart.call(this,this.props.data)}},{key:"componentDidUpdate",value:function(){this.props.data.selectedBoundary.length>0&&this.renderChart.call(this,this.props.data)}},{key:"render",value:function(){return n.a.createElement("div",{style:{height:200}},n.a.createElement("div",{style:{height:200},ref:this.charts}))}}]),t}(r.Component),P=function(e,t){return{title:{text:"\u7edf\u8ba1",left:"center",textStyle:{color:"#111"}},color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:e,axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"\u6570\u91cf",type:"bar",barWidth:"70%",data:t}]}},I=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).charts=n.a.createRef(),a.lineChartsInstance=null,a.option=P(e.data),a}return Object(d.a)(t,e),Object(h.a)(t,[{key:"renderChart",value:function(e){var t=this,a={};e=e.selectedEvents.forEach(function(e){a[e.attributes.HCityName]?a[e.attributes.HCityName]++:a[e.attributes.HCityName]=1});var r=[],n=[];Object.entries(a).forEach(function(e){r.push(e[0]),n.push(e[1])}),console.log(r,n),this.lineChartsInstance=k.a.init(this.charts.current),this.lineChartsInstance.setOption(P(r,n),!0),this.lineChartsInstance.on("click","series",function(e){var a=e.dataIndex,r=e.name;console.log(e),t.props.onClick(a,r)})}},{key:"componentDidMount",value:function(){this.props.data.length&&this.renderChart.call(this,this.props.data)}},{key:"componentDidUpdate",value:function(){this.props.data.selectedBoundary.length>0&&this.renderChart.call(this,this.props.data)}},{key:"render",value:function(){return n.a.createElement("div",{style:{height:200}},n.a.createElement("div",{style:{height:200},ref:this.charts}))}}]),t}(r.Component),M=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement(m.a,{title:"Basic Modal",visible:this.props.visible,onOk:this.props.handleOk,onCancel:this.props.handleCancel,centered:!0,width:"80%"},this.props.children))}}]),t}(n.a.Component),D={"\u590f":"\u590f\u671d","\u5546":"\u5546\u671d","\u5468":"\u5468\u671d","\u6625\u79cb":"\u6625\u79cb","\u6218\u56fd":"\u6218\u56fd","\u79e6":"\u79e6\u671d","\u6c49":"\u6c49\u671d","\u4e09\u56fd":"\u4e09\u56fd/5428","\u664b":"\u664b\u671d","\u5341\u516d\u56fd":"\u5341\u516d\u56fd","\u968b":"\u968b\u671d","\u5510":"\u5510\u671d","\u4e94\u4ee3\u5341\u56fd":"\u4e94\u4ee3\u5341\u56fd","\u5b8b":"\u5b8b\u671d","\u5143":"\u5143\u671d","\u660e":"\u660e\u671d","\u6e05":"\u6e05\u671d","\u6c11\u56fd":"\u6c11\u56fd","\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd":"\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd"},N=a(324),F=a.n(N),Y=a(745),B=a(332),_=a(9),A=Y.a.Option,H=Y.a.OptGroup,R=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={dataSource:a.initData("")},a}return Object(d.a)(t,e),Object(h.a)(t,[{key:"onSelect",value:function(e){if(console.log(this.props),e.includes(":")){var t=e.split(": ")[0];this.props.onSelect({type:0,payload:t});var a=e.split(": ")[1],r=a.endsWith("\u5e74")?3:-1!==this.props.event[t].findIndex(function(e){return e.HName===a})?2:1,n=null;1===r?(n=this.props.people[t].find(function(e){return e.Name===a}).FID,this.props.onSelect({type:r,payload:n})):2===r?(n=this.props.event[t].find(function(e){return e.HName===a}).FID,console.log(this.props.event[t].find(function(e){return e.HName===a})),this.props.onSelect({type:r,payload:n})):3===r&&(n=this.props.year[t].find(function(e){return e.Year===a}).idx,this.props.onSelect({type:r,payload:n}))}}},{key:"initData",value:function(e){var t=this;if(!this.props.year)return null;var a=[],r=[];Object.keys(this.props.year).forEach(function(e){t.props.year[e].forEach(function(t){-1===r.indexOf(e+": "+t.Year)&&(a.push({title:e,content:e+": "+t.Year}),r.push(e+": "+t.Year))})});var i=[];r=[],Object.keys(this.props.event).forEach(function(a){t.props.event[a].forEach(function(t){t.HName.includes(e)&&-1===r.indexOf(a+": "+t.HName)&&i.push({title:a,content:a+": "+t.HName})})});var s=[];r=[],Object.keys(this.props.people).forEach(function(a){t.props.people[a].forEach(function(t){t.Name.includes(e)&&-1===r.indexOf(a+": "+t.Name)&&s.push({title:a,content:a+": "+t.Name})})});var o=[{title:"\u5e74\u4ee3",children:a},{title:"\u4e8b\u4ef6",children:i},{title:"\u4eba\u7269",children:s}].map(function(e){return n.a.createElement(H,{key:e.title,label:(t=e.title,n.a.createElement("span",null,t))},e.children.map(function(e,t){return n.a.createElement(A,{key:e.title+e.content+t,value:e.content},n.a.createElement("span",{className:"certain-search-item-count"},e.content))}));var t});this.setState({dataSource:o})}},{key:"handleSearch",value:function(e){this.initData(e)}},{key:"render",value:function(){return n.a.createElement("div",{className:F.a.searchWrapper,style:{width:250}},n.a.createElement(Y.a,{className:"certain-category-search",dropdownClassName:"certain-category-search-dropdown",dropdownMatchSelectWidth:!0,dropdownStyle:{width:300},size:"large",style:{width:"100%"},dataSource:this.state.dataSource,placeholder:"\u641c\u7d22",optionLabelProp:"value",onSearch:this.handleSearch.bind(this),onSelect:this.onSelect.bind(this)},n.a.createElement(B.a,{suffix:n.a.createElement(_.a,{type:"search",className:"certain-category-icon"})})))}}]),t}(r.Component),U={0:[0,1],1:[1,2],2:[2,5],3:[5,10],4:[10,15],5:[15,19],6:[19,38],7:[38,41],8:[41,47],9:[47,51],10:[51,61],11:[61,69],12:[69,82],13:[82,91],14:[91,103],15:[103,111],16:[111,117],17:[117,128],18:[128,134]};var W=S.a.Option,z=f.a.SubMenu,q=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).state={collapsed:!1,yearLabel:void 0,showYearModal:!1,showWiki:!1,currentYear:["\u5510","619\u5e74"],currentPeople:null,currentEvent:null},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"handleEventSelect",value:function(e){this.props.onSelectEvent&&this.props.onSelectEvent(e),this.setState({currentEvent:e})}},{key:"handlePeopleSelect",value:function(e){this.props.onSelectChar&&this.props.onSelectChar(e),this.setState({currentPeople:e})}},{key:"handleYearSelect",value:function(e,t,a){this.props.onSelectDynasty&&this.props.onSelectDynasty(e),this.props.onSelectYear&&this.props.onSelectYear(a),this.setState({currentYear:[e,t]})}},{key:"handleBarClick",value:function(e,t){if(t.split(" ").toString()+"\u5e74"!==this.state.currentYear.toString()){var a=t.split(" ");a[1]+="\u5e74",this.setState({currentYear:a}),this.handleYearSelect(a[0],a[1],e)}}},{key:"openYearModal",value:function(){this.setState({showYearModal:!0})}},{key:"render",value:function(){var e=this,t=D[this.state.currentYear[0]],a=n.a.createElement(f.a,{style:{maxHeight:500,overflowY:"auto"}},function(t){for(var a=[],r=function(){var r=s[i];a.push(n.a.createElement(z,{title:r,key:r},t[r].map(function(t,a){return n.a.createElement(f.a.Item,{key:r+t.Year+a,onClick:e.handleYearSelect.bind(e,r,t.Year,t.idx)},t.Year)})))},i=0,s=Object.keys(t);i<s.length;i++)r();return a}(this.props.years)),r=n.a.createElement(S.a,{showSearch:!0,onChange:this.handleEventSelect.bind(this),allowClear:!0,placeholder:"".concat(this.state.currentYear[0],": \u5386\u53f2\u4e8b\u4ef6"),style:{width:140,overflowY:"auto"}},this.props.events[this.state.currentYear[0]]&&this.props.events[this.state.currentYear[0]].map(function(e){return n.a.createElement(W,{value:e.FID,key:e.FID},e.HName)})),i=n.a.createElement(S.a,{showSearch:!0,onChange:this.handlePeopleSelect.bind(this),allowClear:!0,placeholder:"".concat(this.state.currentYear[0],": \u5386\u53f2\u4eba\u7269"),style:{width:140,overflowY:"auto"}},this.props.charProfiles[this.state.currentYear[0]]&&this.props.charProfiles[this.state.currentYear[0]].map(function(e){return n.a.createElement(W,{value:e.FID,key:e.FID},e.Name)})),s=n.a.createElement(f.a,{style:{maxHeight:500,overflowY:"auto"}},this.props.currentTile&&Object.keys(this.props.tilesMap).map(function(t){return n.a.createElement(f.a.Item,{key:t,onClick:function(){e.props.handleTileSelect(t)}},e.props.tilesMap[t])}));return n.a.createElement("div",null,n.a.createElement("div",{className:C.a.selectors},n.a.createElement("div",null,n.a.createElement(b.a,{overlay:a,trigger:["click"]},n.a.createElement(g.a,null,this.state.currentYear.join(" ")||"\u5e74\u4ee3\u8fb9\u754c"))),n.a.createElement("div",null,i),n.a.createElement("div",null,r),n.a.createElement("div",null,n.a.createElement(b.a,{overlay:s,trigger:["click"]},n.a.createElement(g.a,null,"\u5e95\u56fe: ".concat(this.props.tilesMap[this.props.currentTile]||"Community"))))),n.a.createElement("div",{className:C.a.chartContainer},n.a.createElement(O,{onClick:this.handleBarClick.bind(this),data:this.props.yearArea})),n.a.createElement("div",{className:C.a.yearModal},n.a.createElement(g.a,{onClick:this.openYearModal.bind(this)},"\u5e74\u4ee3\u53d8\u5316"),n.a.createElement(M,{visible:this.state.showYearModal,handleCancel:function(){return e.setState({showYearModal:!1})},handleOk:function(){return e.setState({showYearModal:!1})}},n.a.createElement(g.a,{onClick:function(){return e.setState({showWiki:!e.state.showWiki})}},"\u663e\u793a\u767e\u79d1"),this.state.showWiki&&n.a.createElement("iframe",{name:"wiki_frame",title:"baike",src:"https://baike.baidu.com/item/"+t,height:"600px",width:"1240px",seamless:!0,frameborder:"0"}),n.a.createElement(O,{style:{position:"relative",left:0,right:0,bottom:0},onClick:this.handleBarClick.bind(this),data:this.props.yearArea}))))}}]),t}(r.Component),V=a(333),G=a(743),Q=a(744),X=a(91),Z=a(325),J=a.n(Z),K=a(211),$=a.n(K);function ee(e,t){var a=new t({view:e.view,layer:e.graphicsLayer2});return a.on("create",function(t){e.setState({rightDrawShow:!0});var a=[],r=[];if("complete"===t.state){e.selectGrphics=[];var n=e.baseBoundaryFeatureLayer.createQuery();e.selectGrphics.push(t.graphic),n.geometry=t.graphic.geometry,n.spatialRelationship="intersects",e.baseBoundaryFeatureLayer.queryFeatures(n).then(function(t){if(e.boundaryhighlight&&e.boundaryhighlight.remove(),e.boundaryhighlight=e.featureLayerView.highlight(t.features),t.features.length){var r=!0,n=!1,i=void 0;try{for(var s,o=t.features[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var l=s.value;a.push(l)}}catch(c){n=!0,i=c}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}e.setState({selectedBoundary:a})}}),n=e.baseEventFeatureLayer.createQuery(),e.selectGrphics.push(t.graphic),n.geometry=t.graphic.geometry,n.spatialRelationship="intersects",e.baseEventFeatureLayer.queryFeatures(n).then(function(t){if(e.eventHightLight&&e.eventHightLight.remove(),e.eventHightLight=e.featureLayerView.highlight(t.features),t.features.length){var a=!0,n=!1,i=void 0;try{for(var s,o=t.features[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var l=s.value;r.push(l)}}catch(c){n=!0,i=c}finally{try{a||null==o.return||o.return()}finally{if(n)throw i}}e.setState({selectedEvents:r})}})}}),a.on("update",function(t){e.setState({rightDrawShow:!0})}),a}var te={type:"heatmap",colorStops:[{color:"rgba(63, 40, 102, 0)",ratio:0},{color:"#472b77",ratio:.083},{color:"#4e2d87",ratio:.166},{color:"#563098",ratio:.249},{color:"#5d32a8",ratio:.332},{color:"#6735be",ratio:.415},{color:"#7139d4",ratio:.498},{color:"#7b3ce9",ratio:.581},{color:"#853fff",ratio:.664},{color:"#a46fbf",ratio:.747},{color:"#c29f80",ratio:.83},{color:"#e0cf40",ratio:.913},{color:"#ffff00",ratio:1}],maxPixelIntensity:65,minPixelIntensity:0},ae={type:"simple",symbol:{type:"text",color:"#4e2d87",text:"\ue643",font:{size:22,family:"CalciteWebCoreIcons",weight:"lighter"}}},re={type:"simple",symbol:{type:"text",color:"#c29f80",text:"\ue675",font:{size:22,family:"CalciteWebCoreIcons",weight:"lighter"}}},ne={staticPath:"http://tony-space.top:8007/",gisRestServer:"https://arcserver.tony-space.top:8001/arcgis/rest/services/",dojoServer:"http://tony-space.top:8007/arcgis_js_api/library/4.11/dojo/dojo.js",commentApi:"http://tony-space.top:8007/api/esri-"},ie=ne.gisRestServer+"country_boundary/MapServer/",se=ne.gisRestServer+"events_point/MapServer/",oe=ne.gisRestServer+"experience/MapServer/0",le={url:ie+"69",visible:!0,renderer:{type:"unique-value",field:"China",defaultSymbol:{type:"simple-fill"},uniqueValueInfos:[{value:"0",symbol:{type:"simple-fill",color:[51,51,204,.5],outline:{color:[220,220,220,.5],width:"0.5px"}}},{value:"1",symbol:{type:"simple-fill",color:[151,51,204,.5],outline:{color:[220,220,220,.5],width:"0.5px"}}},{value:"2",symbol:{type:"simple-fill",color:[51,51,44,.5],outline:{color:[220,220,220,.5],width:"0.5px"}}},{value:"3",symbol:{type:"simple-fill",color:[251,51,204,.5],outline:{color:[220,220,220,.5],width:"0.5px"}}}]},labelingInfo:[{symbol:{type:"text",color:"#555",haloColor:"black",font:{family:"KaiTi",size:18}},labelPlacement:"above-center",labelExpressionInfo:{expression:"$feature.Name"}}]},ce={url:se+"12",visible:!0,popupTemplate:{title:"\u4e8b\u4ef6\u4fe1\u606f",content:[{type:"fields",fieldInfos:[{fieldName:"HName",label:"\u540d\u79f0",format:{places:0,digitSeparator:!0}},{fieldName:"HCityName",label:"\u53d1\u751f\u5730",format:{places:0,digitSeparator:!0}},{fieldName:"Intro",label:"\u7b80\u4ecb",format:{places:0,digitSeparator:!0}},{fieldName:"STime",label:"\u5f00\u59cb\u65f6\u95f4",format:{places:0,digitSeparator:!0}},{fieldName:"ETime",label:"\u7ed3\u675f\u65f6\u95f4",format:{places:0,digitSeparator:!0}}]}]},renderer:ae},he={url:oe,visible:!0,renderer:re,popupTemplate:{title:"\u4eba\u7269\u7ecf\u5386",content:[{type:"fields",fieldInfos:[{fieldName:"Poet",label:"\u59d3\u540d",format:{places:0,digitSeparator:!0}},{fieldName:"Year",label:"\u5e74\u4efd",format:{places:0,digitSeparator:!0}},{fieldName:"Place",label:"\u5730\u70b9",format:{places:0,digitSeparator:!0}},{fieldName:"Content",label:"\u7ecf\u5386",format:{places:0,digitSeparator:!0}}]}]},definitionExpression:"Sequence=0 and Dynasty_ID=12"},ue=a(742),pe=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).state={isOpen:!1},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(ue.a,{title:"\u68c0\u7d22",placement:"right",closable:!0,visible:this.props.isShow,mask:!1,style:{marginTop:"60px"},onClose:this.props.onClose},n.a.createElement("div",{style:{fontSize:18}},"\u7586\u57df"),n.a.createElement("br",null),n.a.createElement(L,{data:this.props.data}),this.props.data.selectedBoundary.map(function(e){return n.a.createElement("div",null,"\u540d\u79f0\uff1a",e.attributes.Name," ",n.a.createElement("br",null),"\u9762\u79ef\uff1a",e.attributes.Area," ",n.a.createElement("br",null),n.a.createElement("hr",null))}),n.a.createElement("div",{style:{fontSize:18}},"\u4e8b\u4ef6"),n.a.createElement("br",null),n.a.createElement(I,{data:this.props.data}),this.props.data.selectedEvents.map(function(t){return n.a.createElement("div",{onMouseOver:function(){e.props.onHoverResult(t.geometry,t.attributes.HName,t.attributes.Intro)}},"\u540d\u79f0\uff1a",t.attributes.HName," ",n.a.createElement("br",null),"\u57ce\u5e02\uff1a",t.attributes.HCityName.trim()?t.attributes.HCityName:"\u65e0\u57ce\u5e02\u4fe1\u606f"," ",n.a.createElement("br",null),n.a.createElement("hr",null))}))}}]),t}(r.Component),de=g.a.Group,me=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).dojoUrl=ne.dojoServer,e.tileMapUrl="http://cache1.arcgisonline.cn/arcgis/rest/services/ChinaOnlineCommunity/MapServer",e.baseBoundaryFeatureUrl=ne.gisRestServer+"country_boundary/MapServer/",e.baseEventFeatureUrl=ne.gisRestServer+"events_point/MapServer",e.basePeopleFeatureUrl=ne.gisRestServer+"experience/MapServer/",e.state={isPlay:!1,playControllerText:"\u64ad\u653e\u8fb9\u754c\u53d8\u5316",sliderValue:0,selectedBoundary:[],rightDrawShow:!1,showYearModal:!1,showBoundary:!0,showChar:!0,showEvent:!0,selectedEvents:[],showTraj:0,bntLabel:"\u663e\u793a\u8f68\u8ff9",speedChange:!1,speed:101,expIdx:-1,showExp:!1},e.playTimer=null,e.stopUpdate=!0,e.selectGrphics=[],e.changeBaseMap=function(){},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){this.initMap()}},{key:"handleMouseOverSearchResult",value:function(e,t,a,r){this.view&&this.view.popup.open({title:t,content:a,location:e})}},{key:"onSearchSelect",value:function(e){switch(console.log("action",e),e.type){case 0:this.props.onSelectDynasty(e.payload);break;case 1:this.props.onSelectChar(e.payload);break;case 2:this.props.onSelectEvent(e.payload);break;case 3:this.props.onSelectYear(e.payload)}}},{key:"componentDidUpdate",value:function(e,t){e.currentYear===this.props.currentYear&&e.trigger.eventHeatmap===this.props.trigger.eventHeatmap&&e.trigger.heatmap===this.props.trigger.heatmap||this.changeBoundaryLayer.call(this,this.props.currentYear),e.currentTileMap!==this.props.currentTileMap&&(console.log(this.props.currentTileMap),this.changeBaseMap(this.props.currentTileMap)),t.selectedBoundary!==this.state.selectedBoundary&&this.setState({rightDrawShow:!0}),this.sketch&&(this.props.trigger.toolbar?this.view.ui.add(this.sketch,"top-left"):this.view.ui.remove(this.sketch)),this.trajCtrl(e.currentChar),this.basePeopleFeatureLayer&&(this.basePeopleFeatureLayer.visible=this.props.trigger.showChar),this.baseBoundaryFeatureLayer&&(this.props.trigger.showOther?this.baseBoundaryFeatureLayer.definitionExpression=void 0:this.baseBoundaryFeatureLayer.definitionExpression="China>0")}},{key:"trajCtrl",value:function(e){if(!this.props.trigger.showChar)return this.t&&(clearInterval(this.t),this.t=null),this.state.showTraj>0&&this.setState({showTraj:0,bntLabel:"\u663e\u793a\u8f68\u8ff9",speedChange:!1}),this.graphic&&(this.graphic.geometry=void 0),void(this.polyline&&(this.polyline.paths=[]));e>=0&&void 0===this.props.currentChar?(this.t&&(clearInterval(this.t),this.t=null),this.state.showTraj>0&&this.setState({showTraj:0,bntLabel:"\u663e\u793a\u8f68\u8ff9",speedChange:!1}),this.graphic&&(this.graphic.geometry=void 0),this.polyline&&(this.polyline.paths=[]),this.basePeopleFeatureLayer&&(this.basePeopleFeatureLayer.definitionExpression="Sequence=0 and Dynasty='".concat(this.props.currentDynasty,"'"))):e>=0&&this.props.currentChar>=0&&e!==this.props.currentChar?(this.t&&(clearInterval(this.t),this.t=null),this.state.showTraj>0&&this.setState({showTraj:0,bntLabel:"\u663e\u793a\u8f68\u8ff9",speedChange:!1}),this.graphic&&(this.graphic.geometry=void 0),this.polyline&&(this.polyline.paths=[]),this.view&&this.loadingPath(),this.basePeopleFeatureLayer&&(this.basePeopleFeatureLayer.definitionExpression="Poet_ID="+this.props.currentChar)):e||this.props.currentChar?(this.basePeopleFeatureLayer&&e!==this.props.currentChar&&(this.basePeopleFeatureLayer.definitionExpression="Poet_ID="+this.props.currentChar),0===this.state.showTraj?(this.t&&(clearInterval(this.t),this.t=null),this.polyline&&(this.polyline.paths=[]),this.view&&this.loadingPath()):this.state.showTraj%2!==0?(this.state.speedChange&&this.t&&(clearInterval(this.t),this.t=null),this.traj&&this.traj.length>0&&(this.t||this.play())):this.t&&(clearInterval(this.t),this.t=null)):this.basePeopleFeatureLayer&&(this.basePeopleFeatureLayer.definitionExpression="Sequence=0 and Dynasty='".concat(this.props.currentDynasty,"'"))}},{key:"play",value:function(){var e=this;this.t=setInterval(function(){if(e.traj.length>0){var t=e.traj.shift();e.props.trigger.track&&e.view.goTo({center:t,zoom:6},{duration:1e3,easing:"in-out-expo"}),e.polyline.paths.push(t),e.graphic.geometry=e.polyline;var a=e.nodeIdx.shift();e.polyline.paths.length===a?e.view.whenLayerView(e.basePeopleFeatureLayer).then(function(t){var a=e.basePeopleFeatureLayer.createQuery();a.where="Poet_ID="+e.props.currentChar,e.basePeopleFeatureLayer.queryFeatures(a).then(function(a){e.setState({expIdx:e.state.expIdx+1},function(){});var r=a.features[a.features.length-e.nodeIdx.length-1],n=t.highlight(r);setTimeout(function(){n.remove()},700)})}):e.nodeIdx.unshift(a)}else clearInterval(e.t),e.t=null,e.setState({showTraj:0,bntLabel:"\u663e\u793a\u8f68\u8ff9",speedChange:!1}),setTimeout(function(){e.setState({expIdx:-1})},1e3)},this.state.speed)}},{key:"loadingPath",value:function(){var e=this;this.view.whenLayerView(this.basePeopleFeatureLayer).then(function(){var t=e.basePeopleFeatureLayer.createQuery();t.where="Poet_ID="+e.props.currentChar,e.basePeopleFeatureLayer.queryFeatures(t).then(function(t){var a=t.features;e.traj=[],e.cnt=0,e.nodeIdx=[1];for(var r=0;r<a.length-1;r++)e.traj.push.apply(e.traj,e.interpolation(a[r].geometry,a[r+1].geometry,r%2===0?1:-1)),e.nodeIdx.push(e.cnt)})})}},{key:"interpolation",value:function(e,t,a){var r=Math.PI/6+Math.round(Math.random())/5,n={x:0,y:0};if(e.x===t.x)n.x=e.x+Math.abs(t.y-e.y)/2*Math.tan(r),n.y=e.y;else{var i=-(t.x-e.x)/(t.y-e.y),s=(e.x+t.x)/2,o=(e.y+t.y)/2,l=a*Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))/2*Math.tan(r);n.x=s+l*Math.sqrt(1/(1+i*i)),n.y=o+l*Math.sqrt(1/(1+i*i))*i}for(var c=0,h=.1/Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),u={x:0,y:0},p={x:0,y:0},d={x:0,y:0},m=[];c<=1;)p.x=(1-c)*e.x+c*n.x,p.y=(1-c)*e.y+c*n.y,d.x=(1-c)*n.x+c*t.x,d.y=(1-c)*n.y+c*t.y,u.x=(1-c)*p.x+c*d.x,u.y=(1-c)*p.y+c*d.y,m.push([u.x,u.y]),this.cnt++,c+=h;return m.push([t.x,t.y]),this.cnt++,m}},{key:"initMap",value:function(){var e=this;J.a.loadModules(["esri/layers/GraphicsLayer","esri/widgets/Sketch","esri/Map","esri/Basemap","esri/layers/TileLayer","esri/views/MapView","esri/layers/FeatureLayer","esri/Graphic","esri/widgets/Zoom","esri/widgets/Compass","esri/widgets/ScaleBar","dojo/domReady!"],this.dojoUrl).then(function(t){var a=Object(V.a)(t,11),r=a[0],n=a[1],i=a[2],s=a[3],o=a[4],l=a[5],c=a[6],h=a[7],u=a[8],p=a[9],d=a[10];e.FeatureLayer=c,e.Basemap=s,e.graphicsLayer2=new r,e.baseBoundaryFeatureLayer=new c(le),e.baseEventFeatureLayer=new c(ce),e.basePeopleFeatureLayer=new c(he),e.changeBaseMap=function(t){var a=new o({url:t}),r=new s({baseLayers:[a],id:"myBaseMap"});e.map&&(e.map.basemap=r)};var m=new o({url:e.tileMapUrl}),y=new s({baseLayers:[m],id:"myBaseMap"});e.map=new i({basemap:y,layers:[e.graphicsLayer2,e.baseEventFeatureLayer,e.basePeopleFeatureLayer,e.baseBoundaryFeatureLayer]}),e.view=new l({center:[115,32.1],map:e.map,container:"mapDiv",zoom:5}),e.view.whenLayerView(e.baseBoundaryFeatureLayer).then(function(t){e.featureLayerView=t}),e.graphic=new h;var v=new u({view:e.view,layout:"horizontal"}),f=new p({view:e.view}),b=new d({view:e.view,unit:"metric"});e.sketch=ee(e,n),e.graphic.symbol={type:"simple-line",color:[226,119,40],width:1.5},e.polyline={type:"polyline",paths:[]},e.sketch=ee(e,n),e.view.graphics.add(e.graphic),e.view.ui.padding={top:80,left:30,right:0,bottom:0},e.view.ui.remove("zoom"),e.view.ui.add(v),e.view.ui.add(f),e.view.ui.add(b,"bottom-right"),e.view.ui.add(e.sketch,"top-left")})}},{key:"changeBoundaryLayer",value:function(e,t){if(!this.map||!this.FeatureLayer)return 0;this.baseEventFeatureLayer&&(this.props.trigger.eventHeatmap?ce.renderer=te:ce.renderer=ae),this.basePeopleFeatureLayer&&(this.props.trigger.heatmap?he.renderer=te:he.renderer=re),le.url=le.url.split("/").slice(0,-1).join("/")+"/"+e,this.baseBoundaryFeatureLayer=new this.FeatureLayer(le);var a=function(e){var t=0;return Object.keys(U).forEach(function(a){U[a][1]>e&&U[a][0]<=e&&(t=parseInt(a))}),t}(e);ce.url=le.url.split("/").slice(0,-1).join("/")+"/"+a,this.baseEventFeatureLayer=new this.FeatureLayer(ce),this.basePeopleFeatureLayer=new this.FeatureLayer(he),this.state.currentDynasty!==this.props.currentDynasty&&(he.definitionExpression="Sequence=0 and Dynasty_ID="+String(this.props.currentDynasty)),this.map.layers=[this.graphicsLayer2,this.baseEventFeatureLayer,this.basePeopleFeatureLayer,this.baseBoundaryFeatureLayer]}},{key:"openYearModal",value:function(){this.setState({yearModal:!0})}},{key:"handleLayerPlay",value:function(){var e=this;this.stopUpdate=!this.stopUpdate,this.setState({isPlay:!this.state.isPlay}),this.view.goTo({center:[115,32.1],zoom:4},{duration:1e3,easing:"in-out-expo"});var t=0;if(this.playTimer)return clearInterval(this.playTimer),this.playTimer=null,void this.setState({playControllerText:"\u64ad\u653e\u8fb9\u754c\u53d8\u5316",isPlay:!1});this.setState({playControllerText:"\u3000\u6682\u505c\u64ad\u653e\u3000",isPlay:!0}),this.playTimer=setInterval(function(){t<121?(t&&e.changeBoundaryLayer.call(e,t),e.setState({sliderValue:t})):(e.stopUpdate=!e.stopUpdate,e.setState({isPlay:!1}),e.changeBoundaryLayer.call(e,t),clearInterval(e.playTimer),e.playTimer=null),t++},2e3)}},{key:"handleShowPath",value:function(){null!==this.props.currentChar&&void 0!==this.props.currentChar||G.a.error("\u8bf7\u9009\u62e9\u4eba\u7269",2),this.setState({showTraj:this.props.currentChar?this.state.showTraj+1:0,bntLabel:this.props.currentChar?this.state.showTraj%2===0?"\u6682\u3000\u505c\u3000 ":"\u7ee7\u3000\u7eed\u3000 ":"\u663e\u793a\u8f68\u8ff9",speedChange:!1})}},{key:"handleSpeedDown",value:function(){this.state.speed<191&&this.setState({speed:this.state.speed+10,speedChange:!0})}},{key:"handleSpeedUp",value:function(){this.state.speed>1&&this.setState({speed:this.state.speed-10,speedChange:!0})}},{key:"handleExpNav",value:function(e){var t=this;this.view.whenLayerView(this.basePeopleFeatureLayer).then(function(a){var r=t.basePeopleFeatureLayer.createQuery();r.where="Poet_ID=".concat(t.props.currentChar," and Sequence=").concat(e),t.basePeopleFeatureLayer.queryFeatures(r).then(function(e){var r=e.features[0],n=a.highlight(r);setTimeout(function(){n.remove()},2e3),t.view.goTo({center:r.geometry,zoom:6},{duration:1e3,easing:"in-out-expo"})})})}},{key:"render",value:function(){var e=this,t=n.a.createElement(Q.a,null,n.a.createElement("div",{className:"charExp"},"\u4eba\u7269\u7ecf\u5386"),this.props.currentChar>=0?this.props.experience.map(function(t,a){return n.a.createElement(Q.a.Item,{onClick:e.handleExpNav.bind(e,a),style:{color:e.state.expIdx===a?"deepskyblue":""},dot:a===e.state.expIdx?n.a.createElement(_.a,{type:"loading",style:{fontSize:"20px"}}):void 0},t.Year+"\u5e74\uff0c"+t.Place+"\uff0c"+t.Content)}):n.a.createElement(X.a,{description:"\u8bf7\u9009\u62e9\u4eba\u7269"}));return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{id:"mapDiv",style:{height:"100%",width:"100%",padding:"5px"}}),this.props.trigger.showExp?t:void 0,n.a.createElement("div",{className:$.a.traj_set},n.a.createElement(g.a,{icon:this.state.showTraj%2===0?"caret-right":"loading",onClick:this.handleShowPath.bind(this)},this.state.bntLabel),n.a.createElement(de,null,n.a.createElement(g.a,{icon:"step-backward",onClick:this.handleSpeedDown.bind(this)}),n.a.createElement(g.a,null,"\xd7"+((101-this.state.speed)/100+1).toFixed(1)),n.a.createElement(g.a,{icon:"step-forward",onClick:this.handleSpeedUp.bind(this)}))),n.a.createElement("div",{className:$.a.play_button},n.a.createElement(g.a,{onClick:this.handleLayerPlay.bind(this),icon:this.state.isPlay?"loading":"caret-right"},this.state.playControllerText)),n.a.createElement(pe,{isShow:this.state.rightDrawShow,onClose:function(){return e.setState({rightDrawShow:!1})},onHoverResult:this.handleMouseOverSearchResult.bind(this),data:{years:this.props.years,charProfiles:this.props.charProfiles,events:this.props.events,selectedBoundary:this.state.selectedBoundary,selectedEvents:this.state.selectedEvents}}),!this.state.rightDrawShow&&n.a.createElement(g.a,{style:{position:"absolute",right:0,bottom:3,height:"99%",width:15,padding:0},onClick:function(){return e.setState({rightDrawShow:!0})}},"<"),n.a.createElement(R,{year:this.props.years,event:this.props.events,people:this.props.charProfiles,onSelect:this.onSearchSelect.bind(this)}))}}]),t}(r.Component),ye=a(738),ve=a(734),fe=B.a.TextArea,be=function(e){var t=e.onChange,a=e.onSubmit,r=e.submitting,i=e.value;return n.a.createElement("div",null,n.a.createElement(ye.a.Item,null,n.a.createElement(fe,{rows:4,onChange:t,value:i})),n.a.createElement(ye.a.Item,null,n.a.createElement(g.a,{htmlType:"submit",loading:r,onClick:a,type:"primary"},"\u6dfb\u52a0\u8bc4\u8bba")))},ge=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={comments:[],submitting:!1,value:""},a}return Object(d.a)(t,e),Object(h.a)(t,[{key:"getComments",value:function(){var e=this,t=ne.commentApi+"getcomments?id="+this.props.id;fetch(t).then(function(e){return e.json()}).then(function(t){e.setState({comments:t})}).catch(function(t){e.setState({comments:[]})})}},{key:"componentDidMount",value:function(){this.getComments()}},{key:"componentDidUpdate",value:function(e){this.props.id!==e.id&&this.getComments()}},{key:"onChange",value:function(e){var t=e.target.value;this.setState({value:t})}},{key:"onSubmit",value:function(){var e=this,t=this.state.value,a=this.props.user?this.props.user:"anonymous",r=ne.commentApi+"addcomments?id=".concat(this.props.id,"&name=").concat(a,"&content=").concat(t);this.setState({submitting:!0}),fetch(r).then(function(t){e.setState({submitting:!1}),e.getComments()},function(t){e.setState({submitting:!1}),e.getComments()})}},{key:"render",value:function(){return n.a.createElement("div",{id:"comments_container",style:{boxShadow:"0px 0px 5px #e6e6e6",padding:5}},n.a.createElement("div",{style:{fontSize:18}},"\u8bc4\u8bba"),this.state.comments.map(function(e){return n.a.createElement(ve.a,{author:n.a.createElement("a",null,e.name),content:n.a.createElement("p",null,e.content)})}),n.a.createElement(ve.a,{content:n.a.createElement(be,{onChange:this.onChange.bind(this),value:this.state.value,submitting:this.state.submitting,onSubmit:this.onSubmit.bind(this)})}))}}]),t}(n.a.Component),Ee=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).state={visible:!1},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=n.a.createElement("div",null);if(this.props.eventProfile){var a=this.props.eventProfile;t=n.a.createElement("div",null,n.a.createElement("p",null,"\u4e8b\u4ef6\u540d\u79f0\uff1a".concat(a.HName)),n.a.createElement("p",null,"\u53d1\u751f\u5730\u70b9\uff1a".concat(a.HCityName)),n.a.createElement("p",null,"\u8d77\u59cb\u65f6\u95f4\uff1a".concat(a.STime)),n.a.createElement("p",null,"\u7ed3\u675f\u65f6\u95f4\uff1a".concat(a.ETime)),n.a.createElement("p",null,"\u7b80\u4ecb\uff1a"),n.a.createElement("p",{style:{textIndent:"2em"}},a.Intro))}else t=n.a.createElement(X.a,{description:"\u8bf7\u9009\u62e9\u4e8b\u4ef6"});return n.a.createElement("div",null,n.a.createElement(g.a,{style:{position:"absolute",right:350,top:25},type:"primary",onClick:function(){e.setState({visible:!e.state.visible})}},"\u4e8b\u4ef6\u7b80\u4ecb"),n.a.createElement(ue.a,{title:"\u4e8b\u4ef6\u7b80\u4ecb",placement:"right",closable:!1,visible:this.state.visible,mask:!1,style:{marginTop:"60px"}},t,this.props.showComment&&n.a.createElement(ge,{id:this.props.eventProfile?this.props.eventProfile.HName:"-1"})))}}]),t}(r.Component),Ce=a(735),Se=a(736),we=a(737),ke=(a(731),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).state={visible:!1},e.iconURL="icon/",e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=n.a.createElement("div",null);if(this.props.charProfile){var a=this.props.charProfile;t=n.a.createElement("div",null,n.a.createElement("div",{style:{align:"center",textAlign:"center"}},n.a.createElement("img",{src:[this.iconURL+a.FID+".jpg"],height:200,width:200})),n.a.createElement("hr",null),n.a.createElement("p",null,"\u59d3\u540d\uff1a".concat(a.Name)),n.a.createElement("p",null,"\u5b57\uff1a".concat(a.zi)),n.a.createElement("p",null,"\u53f7\uff1a".concat(a.hao)),n.a.createElement("p",null,"\u751f\u5e74\uff1a".concat(a.STime)),n.a.createElement("p",null,"\u5352\u5e74\uff1a".concat(a.ETime)),n.a.createElement("p",null,"\u51fa\u751f\u5730\uff1a".concat(a.Home)),n.a.createElement("p",null,"\u7b80\u4ecb\uff1a"),n.a.createElement("p",{style:{textIndent:"2em"}},a.Intro))}else t=n.a.createElement(X.a,{description:"\u8bf7\u9009\u62e9\u4eba\u7269"});return n.a.createElement("div",null,n.a.createElement(g.a,{style:{position:"absolute",right:450,top:25},type:"primary",onClick:function(){e.setState({visible:!e.state.visible})}},"\u4eba\u7269\u7b80\u4ecb"),n.a.createElement(ue.a,{title:"\u4eba\u7269\u7b80\u4ecb",placement:"right",closable:!1,visible:this.state.visible,mask:!1,style:{marginTop:"60px"}},t,this.props.showComment&&n.a.createElement(ge,{id:this.props.charProfile?this.props.charProfile.Name:"1"})))}}]),t}(r.Component)),xe=a(330),je=a.n(xe),Oe=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(n)))).state={visible:!1,placement:"left"},a.showDrawer=function(){a.setState({visible:!0})},a.onClose=function(){a.setState({visible:!1})},a}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{style:{overflow:"hidden",position:"absolute",width:20,height:"100%"}},n.a.createElement(g.a,{className:je.a.toolbox_button,onMouseEnter:this.showDrawer},">"),n.a.createElement(ue.a,{title:"\u5de5\u5177\u7bb1",placement:"left",closable:!0,onClose:this.onClose,visible:this.state.visible,mask:!1,onMouseLeave:this.onClose,getContainer:!1,style:{height:"calc(100% - 64px)",top:64}},this.props.children))}}]),t}(n.a.Component),Te=ne.staticPath,Le={"http://cache1.arcgisonline.cn/arcgis/rest/services/ChinaOnlineStreetWarm/MapServer":"Warm","http://cache1.arcgisonline.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer":"PurplishBlue","http://cache1.arcgisonline.cn/arcgis/rest/services/ChinaOnlineCommunity/MapServer":"Community","https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer":"Satellite"},Pe=Ce.a.Content,Ie=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(p.a)(t).call(this))).state={charProfiles:[],years:[],events:[],experience:[],yearArea:[],Trigger:{heatmap:!1,eventHeatmap:!1,toolbar:!0,comment:!0,showChar:!0,showExp:!1,showOther:!0,track:!1},currentYear:69,currentTileMap:"topo",currentChar:null,currentDynasty:"\u5510",currentEvent:null},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"onSelectYear",value:function(e){this.setState({currentYear:e})}},{key:"onSelectTileMap",value:function(e){this.setState({currentTileMap:e})}},{key:"onSelectDynasty",value:function(e){this.setState({currentDynasty:e})}},{key:"processYearArea",value:function(e){var t=[];return Object.keys(e).forEach(function(a){Object.keys(e[a][0]).forEach(function(r){t.push([a+" "+r,e[a][0][r]])})}),t}},{key:"processYear",value:function(e){var t=0;return Object.keys(e).forEach(function(a){e[a].forEach(function(r,n){e[a][n]={Year:e[a][n]+"\u5e74",idx:t},t++})}),e}},{key:"onSelectChar",value:function(e){this.setState({currentChar:e})}},{key:"onSelectEvent",value:function(e){this.setState({currentEvent:e})}},{key:"componentDidMount",value:function(){var e=this,t=fetch(Te+"json/year.json").then(function(e){return e.json()}),a=fetch(Te+"json/profile.json").then(function(e){return e.json()}),r=fetch(Te+"json/event.json").then(function(e){return e.json()}),n=fetch(Te+"json/experience.json").then(function(e){return e.json()}),i=fetch(Te+"json/area.json").then(function(e){return e.json()});Promise.all([t,a,r,n,i]).then(function(t){console.log(t),e.setState({years:e.processYear(t[0]),charProfiles:t[1],events:t[2],experience:t[3],yearArea:e.processYearArea(t[4])})}).catch(function(e){console.error(e)})}},{key:"render",value:function(){var e,t,a=this;console.log(this);var r,i=[];this.state.experience&&null!==this.state.currentChar&&(r=[]).concat.apply(r,Object(l.a)(Object.values(this.state.experience))).map(function(e){e["Poet ID"]===String(a.state.currentChar)?i.push(e):void 0});return n.a.createElement("div",{className:"App"},n.a.createElement(v,null),n.a.createElement(q,{years:this.state.years,charProfiles:this.state.charProfiles,events:this.state.events,yearArea:this.state.yearArea,tilesMap:Le,handleTileSelect:this.onSelectTileMap.bind(this),currentTile:this.state.currentTileMap,onSelectYear:this.onSelectYear.bind(this),onSelectDynasty:this.onSelectDynasty.bind(this),onSelectChar:this.onSelectChar.bind(this),onSelectEvent:this.onSelectEvent.bind(this)}),n.a.createElement(Ce.a,{style:{position:"relative",height:"calc(100% - 60px)"}},n.a.createElement(Pe,{style:{position:"relative"}},n.a.createElement(me,{years:this.state.years,charProfiles:this.state.charProfiles,events:this.state.events,yearArea:this.state.yearArea,onSelectYear:this.onSelectYear.bind(this),onSelectDynasty:this.onSelectDynasty.bind(this),onSelectChar:this.onSelectChar.bind(this),onSelectEvent:this.onSelectEvent.bind(this),currentYear:this.state.currentYear,currentTileMap:this.state.currentTileMap,trigger:this.state.Trigger,currentDynasty:this.state.currentDynasty,currentChar:this.state.currentChar,experience:i})),n.a.createElement(Oe,null,n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null," ")),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u4eba\u7269\u4eba\u751f\u8f68\u8ff9\u9762\u677f"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{showExp:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173"})),n.a.createElement(we.a,null),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u663e\u793a\u5176\u4ed6\u56fd\u5bb6"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{showOther:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173",defaultChecked:!0})),n.a.createElement(we.a,null),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u5728\u5730\u56fe\u4e0a\u663e\u793a\u9009\u4e2d\u4eba\u7269"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{showChar:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173",defaultChecked:!0})),n.a.createElement(we.a,null),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u5386\u53f2\u4eba\u7269\u5206\u5e03\u70ed\u529b\u56fe"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{heatmap:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173"})),n.a.createElement(we.a,null),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u5386\u53f2\u4e8b\u4ef6\u5206\u5e03\u70ed\u529b\u56fe"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{eventHeatmap:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173"})),n.a.createElement(we.a,null),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u5de5\u5177\u680f"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{toolbar:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173",defaultChecked:!0})),n.a.createElement(we.a,null),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u8f68\u8ff9\u8ddf\u8e2a"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{track:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173"})),n.a.createElement(we.a,null),n.a.createElement("div",{className:"toolbox_item"},n.a.createElement("span",null,"\u5f00\u542f\u8bc4\u8bba"),n.a.createElement(Se.a,{onChange:function(e){return a.setState({Trigger:Object(o.a)({},a.state.Trigger,{comment:e})})},checkedChildren:"\u5f00",unCheckedChildren:"\u5173",defaultChecked:!0}))),n.a.createElement(Ee,{showComment:this.state.Trigger.comment,eventProfile:this.state.events&&null!==this.state.currentEvent?(e=[]).concat.apply(e,Object(l.a)(this.state.events[this.state.currentDynasty]))[this.state.currentEvent]:void 0}),n.a.createElement(ke,{showComment:this.state.Trigger.comment,charProfile:this.state.charProfiles&&null!==this.state.currentChar?(t=[]).concat.apply(t,Object(l.a)(Object.values(this.state.charProfiles)))[this.state.currentChar]:void 0})))}}]),t}(r.Component),Me=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function De(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}s.a.render(n.a.createElement(Ie,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat(".","/service-worker.js");Me?(function(e,t){fetch(e).then(function(a){var r=a.headers.get("content-type");404===a.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):De(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):De(t,e)})}}()}},[[335,1,2]]]);
//# sourceMappingURL=main.d1b4e1f6.chunk.js.map